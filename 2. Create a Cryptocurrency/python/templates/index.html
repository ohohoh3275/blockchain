<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì•”í˜¸í™”í ë¸”ë¡ì²´ì¸ ì‹œìŠ¤í…œ</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        font-weight: 300;
      }

      .header p {
        font-size: 1.1em;
        opacity: 0.9;
      }

      .content {
        padding: 30px;
      }

      .section {
        margin-bottom: 40px;
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        border-left: 4px solid #3498db;
      }

      .section h2 {
        color: #2c3e50;
        margin-bottom: 20px;
        font-size: 1.5em;
        border-bottom: 3px solid #3498db;
        padding-bottom: 10px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #34495e;
      }

      .form-group input,
      .form-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: #3498db;
      }

      .btn {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
        margin-right: 10px;
        margin-bottom: 10px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
      }

      .btn-success {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      }

      .btn-warning {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      }

      .btn-danger {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      }

      .btn-info {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      }

      .result {
        margin-top: 20px;
        padding: 15px;
        border-radius: 8px;
        background: #f8f9fa;
        border-left: 4px solid #3498db;
      }

      .result.success {
        background: #e3f2fd;
        border-left-color: #3498db;
        color: #1565c0;
      }

      .result.error {
        background: #ffebee;
        border-left-color: #e74c3c;
        color: #c62828;
      }

      .result pre {
        background: #2c3e50;
        color: #ecf0f1;
        padding: 15px;
        border-radius: 5px;
        overflow-x: auto;
        font-size: 12px;
        line-height: 1.4;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .node-status {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        margin-bottom: 10px;
        border-left: 4px solid #e0e0e0;
      }

      .node-status.online {
        background: #e3f2fd;
        border-left-color: #3498db;
      }

      .node-status.offline {
        background: #ffebee;
        border-left-color: #e74c3c;
      }

      .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
      }

      .status-indicator.online {
        background: #3498db;
      }

      .status-indicator.offline {
        background: #e74c3c;
      }

      .loading {
        display: none;
        text-align: center;
        padding: 20px;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
      }

      .stat-card h3 {
        font-size: 2em;
        margin-bottom: 5px;
      }

      .stat-card p {
        opacity: 0.9;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ”— ì•”í˜¸í™”í ë¸”ë¡ì²´ì¸ ì‹œìŠ¤í…œ</h1>
        <p>ë¶„ì‚°í˜• ë¸”ë¡ì²´ì¸ ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬ ë° íŠ¸ëœì­ì…˜ ì²˜ë¦¬</p>
      </div>

      <div class="content">
        <!-- ë…¸ë“œ ìƒíƒœ ì„¹ì…˜ -->
        <div class="section">
          <h2>ğŸŒ ë…¸ë“œ ê´€ë¦¬</h2>
          <div class="grid">
            <div>
              <h3>ë…¸ë“œ ì‹œì‘</h3>
              <button class="btn btn-success" onclick="startNodes()">
                ë…¸ë“œë“¤ ì‹œì‘
              </button>
              <div class="node-status" id="node-5000">
                <span
                  ><span class="status-indicator offline"></span>ë©”ì¸ ë…¸ë“œ (í¬íŠ¸
                  5000)</span
                >
                <span>ìƒíƒœ: <span id="status-5000">ì˜¤í”„ë¼ì¸</span></span>
              </div>
              <div class="node-status" id="node-5001">
                <span
                  ><span class="status-indicator offline"></span>ë…¸ë“œ 1 (í¬íŠ¸
                  5001)</span
                >
                <span>ìƒíƒœ: <span id="status-5001">ì˜¤í”„ë¼ì¸</span></span>
              </div>
              <div class="node-status" id="node-5002">
                <span
                  ><span class="status-indicator offline"></span>ë…¸ë“œ 2 (í¬íŠ¸
                  5002)</span
                >
                <span>ìƒíƒœ: <span id="status-5002">ì˜¤í”„ë¼ì¸</span></span>
              </div>
              <div class="node-status" id="node-5003">
                <span
                  ><span class="status-indicator offline"></span>ë…¸ë“œ 3 (í¬íŠ¸
                  5003)</span
                >
                <span>ìƒíƒœ: <span id="status-5003">ì˜¤í”„ë¼ì¸</span></span>
              </div>
            </div>
            <div>
              <h3>ë…¸ë“œ ì—°ê²°</h3>
              <div class="form-group">
                <label>ëŒ€ìƒ ë…¸ë“œ:</label>
                <select id="targetNode">
                  <option value="http://127.0.0.1:5000">
                    ë©”ì¸ ë…¸ë“œ (5000)
                  </option>
                  <option value="http://127.0.0.1:5001">ë…¸ë“œ 1 (5001)</option>
                  <option value="http://127.0.0.1:5002">ë…¸ë“œ 2 (5002)</option>
                  <option value="http://127.0.0.1:5003">ë…¸ë“œ 3 (5003)</option>
                </select>
              </div>
              <button class="btn btn-info" onclick="connectNodes()">
                ë…¸ë“œë“¤ ì—°ê²°
              </button>
              <button class="btn btn-warning" onclick="replaceChain()">
                ì²´ì¸ ë™ê¸°í™”
              </button>
            </div>
          </div>
        </div>

        <!-- ë¸”ë¡ì²´ì¸ í†µê³„ -->
        <div class="section">
          <h2>ğŸ“Š ë¸”ë¡ì²´ì¸ í†µê³„</h2>
          <div class="stats" id="blockchainStats">
            <div class="stat-card">
              <h3 id="blockCount">0</h3>
              <p>ì´ ë¸”ë¡ ìˆ˜</p>
            </div>
            <div class="stat-card">
              <h3 id="transactionCount">0</h3>
              <p>ì´ íŠ¸ëœì­ì…˜ ìˆ˜</p>
            </div>
            <div class="stat-card">
              <h3 id="chainValid">â“</h3>
              <p>ì²´ì¸ ìœ íš¨ì„±</p>
            </div>
            <div class="stat-card">
              <h3 id="connectedNodes">0</h3>
              <p>ì—°ê²°ëœ ë…¸ë“œ</p>
            </div>
          </div>
          <button class="btn btn-info" onclick="updateStats()">
            í†µê³„ ì—…ë°ì´íŠ¸
          </button>
        </div>

        <!-- ë¸”ë¡ ë§ˆì´ë‹ -->
        <div class="section">
          <h2>â›ï¸ ë¸”ë¡ ë§ˆì´ë‹</h2>
          <div class="form-group">
            <label>ë§ˆì´ë‹í•  ë…¸ë“œ:</label>
            <select id="miningNode">
              <option value="http://127.0.0.1:5000">ë©”ì¸ ë…¸ë“œ (5000)</option>
              <option value="http://127.0.0.1:5001">ë…¸ë“œ 1 (5001)</option>
              <option value="http://127.0.0.1:5002">ë…¸ë“œ 2 (5002)</option>
              <option value="http://127.0.0.1:5003">ë…¸ë“œ 3 (5003)</option>
            </select>
          </div>
          <button class="btn btn-success" onclick="mineBlock()">
            ë¸”ë¡ ë§ˆì´ë‹
          </button>
          <div id="miningResult" class="result" style="display: none"></div>
        </div>

        <!-- íŠ¸ëœì­ì…˜ ì¶”ê°€ -->
        <div class="section">
          <h2>ğŸ’¸ íŠ¸ëœì­ì…˜ ì¶”ê°€</h2>
          <div class="grid">
            <div>
              <div class="form-group">
                <label>ë³´ë‚´ëŠ” ì‚¬ëŒ:</label>
                <input type="text" id="sender" placeholder="ë³´ë‚´ëŠ” ì‚¬ëŒ ì£¼ì†Œ" />
              </div>
              <div class="form-group">
                <label>ë°›ëŠ” ì‚¬ëŒ:</label>
                <input type="text" id="receiver" placeholder="ë°›ëŠ” ì‚¬ëŒ ì£¼ì†Œ" />
              </div>
            </div>
            <div>
              <div class="form-group">
                <label>ê¸ˆì•¡:</label>
                <input
                  type="number"
                  id="amount"
                  placeholder="ì „ì†¡í•  ê¸ˆì•¡"
                  step="0.01"
                />
              </div>
              <div class="form-group">
                <label>ëŒ€ìƒ ë…¸ë“œ:</label>
                <select id="transactionNode">
                  <option value="http://127.0.0.1:5000">
                    ë©”ì¸ ë…¸ë“œ (5000)
                  </option>
                  <option value="http://127.0.0.1:5001">ë…¸ë“œ 1 (5001)</option>
                  <option value="http://127.0.0.1:5002">ë…¸ë“œ 2 (5002)</option>
                  <option value="http://127.0.0.1:5003">ë…¸ë“œ 3 (5003)</option>
                </select>
              </div>
            </div>
          </div>
          <button class="btn btn-info" onclick="addTransaction()">
            íŠ¸ëœì­ì…˜ ì¶”ê°€
          </button>
          <div
            id="transactionResult"
            class="result"
            style="display: none"
          ></div>
        </div>

        <!-- ë¸”ë¡ì²´ì¸ ì¡°íšŒ -->
        <div class="section">
          <h2>ğŸ” ë¸”ë¡ì²´ì¸ ì¡°íšŒ</h2>
          <div class="form-group">
            <label>ì¡°íšŒí•  ë…¸ë“œ:</label>
            <select id="chainNode">
              <option value="http://127.0.0.1:5000">ë©”ì¸ ë…¸ë“œ (5000)</option>
              <option value="http://127.0.0.1:5001">ë…¸ë“œ 1 (5001)</option>
              <option value="http://127.0.0.1:5002">ë…¸ë“œ 2 (5002)</option>
              <option value="http://127.0.0.1:5003">ë…¸ë“œ 3 (5003)</option>
            </select>
          </div>
          <button class="btn btn-info" onclick="getChain()">ì²´ì¸ ì¡°íšŒ</button>
          <button class="btn btn-warning" onclick="checkValidity()">
            ìœ íš¨ì„± ê²€ì‚¬
          </button>
          <div id="chainResult" class="result" style="display: none"></div>
        </div>

        <div class="loading" id="loading">
          <div class="spinner"></div>
          <p>ì²˜ë¦¬ ì¤‘...</p>
        </div>
      </div>
    </div>

    <script>
      // API í˜¸ì¶œ í•¨ìˆ˜
      async function apiCall(endpoint, data = {}) {
        try {
          const response = await fetch(`/api/${endpoint}`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });
          return await response.json();
        } catch (error) {
          return { error: `ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}` };
        }
      }

      // ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
      function showResult(elementId, data, isSuccess = true) {
        const element = document.getElementById(elementId);
        element.style.display = "block";
        element.className = `result ${isSuccess ? "success" : "error"}`;

        if (data.error) {
          element.innerHTML = `<strong>ì˜¤ë¥˜:</strong> ${data.error}`;
        } else {
          element.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }
      }

      // ë¡œë”© í‘œì‹œ í•¨ìˆ˜
      function showLoading(show = true) {
        document.getElementById("loading").style.display = show
          ? "block"
          : "none";
      }

      // ë…¸ë“œ ì‹œì‘
      async function startNodes() {
        showLoading(true);
        const result = await apiCall("start_nodes");
        showLoading(false);

        if (result.error) {
          showResult("miningResult", result, false);
        } else {
          showResult("miningResult", result, true);
          // ë…¸ë“œ ìƒíƒœ ì—…ë°ì´íŠ¸
          setTimeout(updateNodeStatus, 2000);
        }
      }

      // ë…¸ë“œ ì—°ê²°
      async function connectNodes() {
        showLoading(true);
        const nodeUrl = document.getElementById("targetNode").value;
        const result = await apiCall("connect_node", {
          node_url: nodeUrl,
          nodes: [
            "http://127.0.0.1:5001",
            "http://127.0.0.1:5002",
            "http://127.0.0.1:5003",
          ],
        });
        showLoading(false);
        showResult("chainResult", result, !result.error);
      }

      // ì²´ì¸ êµì²´
      async function replaceChain() {
        showLoading(true);
        const nodeUrl = document.getElementById("targetNode").value;
        const result = await apiCall("replace_chain", { node_url: nodeUrl });
        showLoading(false);
        showResult("chainResult", result, !result.error);
      }

      // ë¸”ë¡ ë§ˆì´ë‹
      async function mineBlock() {
        showLoading(true);
        const nodeUrl = document.getElementById("miningNode").value;
        const result = await apiCall("mine_block", { node_url: nodeUrl });
        showLoading(false);
        showResult("miningResult", result, !result.error);

        if (!result.error) {
          setTimeout(updateStats, 1000);
        }
      }

      // íŠ¸ëœì­ì…˜ ì¶”ê°€
      async function addTransaction() {
        const sender = document.getElementById("sender").value;
        const receiver = document.getElementById("receiver").value;
        const amount = document.getElementById("amount").value;
        const nodeUrl = document.getElementById("transactionNode").value;

        if (!sender || !receiver || !amount) {
          showResult(
            "transactionResult",
            { error: "ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" },
            false
          );
          return;
        }

        showLoading(true);
        const result = await apiCall("add_transaction", {
          node_url: nodeUrl,
          sender: sender,
          receiver: receiver,
          amount: amount,
        });
        showLoading(false);
        showResult("transactionResult", result, !result.error);
      }

      // ì²´ì¸ ì¡°íšŒ
      async function getChain() {
        showLoading(true);
        const nodeUrl = document.getElementById("chainNode").value;
        const result = await apiCall("get_chain", { node_url: nodeUrl });
        showLoading(false);
        showResult("chainResult", result, !result.error);
      }

      // ìœ íš¨ì„± ê²€ì‚¬
      async function checkValidity() {
        showLoading(true);
        const nodeUrl = document.getElementById("chainNode").value;
        const result = await apiCall("is_valid", { node_url: nodeUrl });
        showLoading(false);
        showResult("chainResult", result, !result.error);
      }

      // í†µê³„ ì—…ë°ì´íŠ¸
      async function updateStats() {
        const nodeUrl = "http://127.0.0.1:5000";

        try {
          const chainResult = await apiCall("get_chain", { node_url: nodeUrl });
          const validityResult = await apiCall("is_valid", {
            node_url: nodeUrl,
          });

          if (!chainResult.error) {
            document.getElementById("blockCount").textContent =
              chainResult.length || 0;

            let totalTransactions = 0;
            if (chainResult.chain) {
              chainResult.chain.forEach((block) => {
                if (block.transactions) {
                  totalTransactions += block.transactions.length;
                }
              });
            }
            document.getElementById("transactionCount").textContent =
              totalTransactions;
          }

          if (!validityResult.error) {
            document.getElementById("chainValid").textContent =
              validityResult.is_valid ? "âœ…" : "âŒ";
          }
        } catch (error) {
          console.error("í†µê³„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:", error);
        }
      }

      // ë…¸ë“œ ìƒíƒœ ì—…ë°ì´íŠ¸
      async function updateNodeStatus() {
        const nodes = ["5000", "5001", "5002", "5003"];

        for (const port of nodes) {
          try {
            const response = await fetch(`http://127.0.0.1:${port}/get_chain`);
            if (response.ok) {
              document.getElementById(`node-${port}`).className =
                "node-status online";
              document
                .getElementById(`node-${port}`)
                .querySelector(".status-indicator").className =
                "status-indicator online";
              document.getElementById(`status-${port}`).textContent = "ì˜¨ë¼ì¸";
            } else {
              throw new Error("ë…¸ë“œ ì‘ë‹µ ì—†ìŒ");
            }
          } catch (error) {
            document.getElementById(`node-${port}`).className =
              "node-status offline";
            document
              .getElementById(`node-${port}`)
              .querySelector(".status-indicator").className =
              "status-indicator offline";
            document.getElementById(`status-${port}`).textContent = "ì˜¤í”„ë¼ì¸";
          }
        }
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
      document.addEventListener("DOMContentLoaded", function () {
        updateNodeStatus();
        updateStats();

        // ì£¼ê¸°ì ìœ¼ë¡œ ìƒíƒœ ì—…ë°ì´íŠ¸
        setInterval(updateNodeStatus, 10000);
        setInterval(updateStats, 30000);
      });
    </script>
  </body>
</html>
